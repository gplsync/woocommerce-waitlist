jQuery(document).ready(function(m){function c(t){return 0<m(t).find("tr.wcwl_user_row").length}function a(t){var i,e;c(t)?(m(i=t).find(".wcwl_waitlist_table").show(),m(i).find(".wcwl_no_users_text ").hide(),m(i).find("button.wcwl_email_add_user").is(":visible")||m(i).find(".wcwl_actions").show(),"archive"==m(i).data("panel")&&m(i).find(".wcwl_add_user_wrap ").show()):(m(e=t).find(".wcwl_actions").hide(),m(e).find(".wcwl_waitlist_table").hide(),m(e).find(".wcwl_no_users_text ").show(),"archive"==m(e).data("panel")&&m(e).find(".wcwl_add_user_wrap").hide()),p()}function n(t){var i=m(t).closest(".wcwl_tab_content");i.find(".wcwl_add_user_content").hide(),i.find(".wcwl_add").show(),i.find(".wcwl_email").val(""),c(i)?(i.find(".wcwl_actions").show(),i.find(".wcwl_no_users").hide()):i.find(".wcwl_no_users").show()}function w(t,c,i,a){var e={action:"wcwl_add_user_to_waitlist",emails:t,product_id:c,wcwl_add_user_nonce:i};m.post(ajaxurl,e,function(t){m(".wcwl_notice").remove();var i=m.parseJSON(t),e=m('.wcwl_body_wrap[data-product-id="'+c+'"] .'+a+" .wcwl_waitlist_table");v(i.users,c,e,a),m("#wcwl_variation_"+c).length&&l(c),x(i.type,i.message,c,a),j(a=m('.wcwl_body_wrap[data-product-id="'+c+'"]').find("."+a),".wcwl_email_add_user"),n(a.find(".wcwl_waitlist_table"))})}function v(t,c,a,n){m.each(t,function(t,i){if(0==a.find('input[data-user-email="'+i.email+'"]').length&&0!==i.id){!function(t,i,e){var c=t.join_date;"archive"==e&&(c=t.date);var a='<tr class="wcwl_user_row" data-user-id="'+t.id+'">';a+='<td><input class="wcwl_user_checkbox" type="checkbox" name="wcwl_user_checkbox" value="'+t.id+'" data-user-email="'+t.email+'" data-date-added="'+c+'"/></td>',a+='<td><strong><a title="'+wcwl_tab.view_profile_text+'" href="'+t.link+'">'+t.email+"</a></strong></td>",a+="<td>"+t.join_date+"</td></tr>",i.append(a)}(i,a,n);var e=m("#wcwl_variation_"+c);0<e.length&&(l(c),e.removeClass("wcwl_hidden"))}})}function l(t){var i=m("#wcwl_variation_"+t+" .wcwl_count"),e=m('.wcwl_body_wrap[data-product-id="'+t+'"] .waitlist tr.wcwl_user_row').length;i.text(parseInt(e))}function k(t){var i="";return m(t).each(function(){i+=m(this).data("user-email")+","}),i}function g(t,e,c,a){m.each(t,function(t,i){a.find('tr[data-user-id="'+i.id+'"]').first().remove(),"waitlist"==c&&m("#wcwl_variation_"+e).length&&l(e)}),0==a.find("tr.wcwl_user_row").length&&(a.hide(),a.closest(".wcwl_tab_content").find(".wcwl_no_users").show(),"archive"==c&&m('.wcwl_body_wrap[data-product-id="'+e+'"] .'+c+" .wcwl_add_user_wrap").hide())}function x(t,i,e,c){m(".wcwl_notice").remove();var a=s(t,i);"options"==c?m(a).insertBefore(m('.wcwl_body_wrap[data-product-id="'+e+'"] .options')):m(a).insertAfter(m('.wcwl_body_wrap[data-product-id="'+e+'"] .'+c+" .wcwl_actions")),"success"==t&&m(".wcwl_notice").delay(3e3).slideToggle(),o()}function s(t,i){var e='<div class="wcwl_notice wcwl_notice_'+t+'">';return e+="<p>"+i+"</p>",e+='<span class="wcwl_dismiss dashicons dashicons-dismiss"></span></div>'}function o(){m(".wcwl_notice").on("click",".wcwl_dismiss",function(){m(this).closest(".wcwl_notice").remove(),m("ul.waitlist-tabs").css("margin-top","0")})}if(m(".wcwl_variation_tab").on("click",".wcwl_header_wrap",function(){m(this).next(m(".wcwl_body_wrap")).slideToggle()}),m("ul.wcwl_tabs").on("click","li",function(){m(".wcwl_notice").remove();var t=m(this).closest(".wcwl_body_wrap");m(t).find("ul.wcwl_tabs li, .wcwl_tab_content").removeClass("current");var i=m(this).data("tab");m(this).addClass("current"),m(t).find(".wcwl_tab_content."+i).addClass("current")}),m(".wcwl_tab_content").each(function(){a(this),p()}),m(".wcwl_add_user_wrap").on("click",".wcwl_add",function(){var t=m(this).closest(".wcwl_tab_content");m(".wcwl_notice").remove(),m(this).hide(),t.find(".wcwl_no_users").hide(),t.find(".wcwl_add_user_content").show(),t.find(".wcwl_actions").hide()}),m(".wcwl_add_user_wrap").on("click",".wcwl_back",function(t){m(".wcwl_notice").remove(),n(this)}),m(".wcwl_add_user_wrap").on("click",".wcwl_email_add_user",function(){var t=m(this).closest(".wcwl_tab_content").find("input.wcwl_email").val().split(","),e=C(this),i=m(this).data("nonce"),c=m('.wcwl_email_add_user[data-product-id="'+e+'"]'),a=m(this).closest(".wcwl_tab_content").data("panel"),n=!1;if(y(c),m.isArray(t))m.each(t,function(t,i){if(!d(i=i.replace(/ /g,"")))return x("error",wcwl_tab.invalid_email,e,a),n=!0,A(a,"add_user",wcwl_tab.add_text),!1}),n||w(t,e,i,a);else{if(!d(t))return x("error",wcwl_tab.invalid_email,e,a),n=!0,A(a,"add_user",wcwl_tab.add_text),!1;w(t,e,i,a)}}),m(".wcwl_waitlist_table").on("click",'input[name="wcwl_select_all"]',function(){var t=m(this).closest("tbody").find(".wcwl_user_checkbox"),i=m(this).prop("checked");m(t).each(function(){m(this).prop("checked",i)})}),m(".wcwl_actions").on("click","button.wcwl_action",function(){var c,a,n,t,i,e,w,l,s,o,_,d=m(this).prev("select.wcwl_action").val(),r=m(this).closest(".wcwl_tab_content").data("panel"),u=C(this);if(d){var p=m('.wcwl_body_wrap[data-product-id="'+u+'"] .'+r+" .wcwl_user_checkbox:checkbox:checked"),h="";if("wcwl_email_custom"==d)0<(h=k(p)).length?window.location="mailto:"+wcwl_tab.admin_email+"?bcc="+h:x("error",wcwl_tab.no_users_text,u,r);else if("wcwl_export"==d)0<(h=k(p)).length?(y(this),l=(w=r)+"-export-"+(e=u)+".csv",s=encodeURI("data:text/csv;charset=utf-8,"+h),o=m('.wcwl_body_wrap[data-product-id="'+e+'"] .'+w),(_=document.createElement("a")).setAttribute("href",s),_.setAttribute("download",l),_.click(),A(o,"action",wcwl_tab.go_text)):x("error",wcwl_tab.no_users_text,u,r);else{var f=(i=[],m(p).each(function(){var t={date:m(this).data("date-added"),id:m(this).val()};i.push(t)}),i),b=m(this).data("nonce");y(this),n=r,t={action:c=d,product_id:a=u,users:f,wcwl_action_nonce:b},m.post(ajaxurl,t,function(t){m(".wcwl_notice").remove();var i=m.parseJSON(t),e="";if("success"==i.type)if("wcwl_remove_waitlist"==c)e=m('.wcwl_body_wrap[data-product-id="'+a+'"] .waitlist .wcwl_waitlist_table'),g(i.users,a,n,e),e.find("input").prop("checked",!1),"yes"==i.archive&&(e=m('.wcwl_body_wrap[data-product-id="'+a+'"] .archive .wcwl_waitlist_table'),v(i.users,a,e,"archive"),archive_panel=m('.wcwl_body_wrap[data-product-id="'+a+'"]').find(".archive"),j(archive_panel,".wcwl_action"));else if("wcwl_remove_archive"==c)e=m('.wcwl_body_wrap[data-product-id="'+a+'"] .archive .wcwl_waitlist_table'),g(i.users,a,n,e),e.find("input").prop("checked",!1);else if("wcwl_return_to_waitlist"==c){e=m('.wcwl_body_wrap[data-product-id="'+a+'"] .waitlist .wcwl_waitlist_table'),v(i.users,a,e,"waitlist"),j(m('.wcwl_body_wrap[data-product-id="'+a+'"] .waitlist'),".wcwl_action")}x(i.type,i.message,a,n),j(m('.wcwl_body_wrap[data-product-id="'+a+'"]').find("."+n),".wcwl_action")})}}else x("error",wcwl_tab.no_action_text,u,r)}),o(),0<m(".wcwl_header_wrap").length){var _=0;m(document).ajaxSuccess(function(t,i,e,c){"string"==typeof c&&c.substring(0,35).includes("woocommerce_variation")&&(m(".wcwl_notice").remove(),1<++_&&(m("#wcwl_waitlist_data").prepend(s("info",wcwl_tab.update_waitlist_notice)),o()))})}function d(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}function y(t){m(t).text(""),m(t).append('<span class="wcwl_loading spinner is-active"></span>'),m(t).attr("disabled","disabled")}function A(t,i,e){var c="";c="add_user"==i?"button.wcwl_email_add_user":"update_options"==i?".options button":"button.wcwl_action",m(t).find(m(c)).text(e),m(c).removeAttr("disabled"),m(c).find("span.wcwl_loading").remove()}function j(t,i){var e=m(t).find("button"+i),c="";type=".wcwl_email_add_user"==i?(c=wcwl_tab.add_text,"add_user"):(c=wcwl_tab.go_text,"action"),A(t,type,c),m(e).prev(".wcwl_email").val(""),m(e).prev("select.wcwl_action").val("0"),a(t)}function C(t){return m(t).closest(".wcwl_body_wrap").data("product-id")}m(".options").on("change",'input[name="enable_stock_trigger"]',function(){m(this).is(":checked")?(m(this).closest(".options").find('input[name="minimum_stock"]').removeAttr("disabled"),m(this).closest(".options").find('label[for="minimum_stock"]').removeClass("wcwl_disabled")):(m(this).closest(".options").find('input[name="minimum_stock"]').attr("disabled","disabled"),m(this).closest(".options").find('label[for="minimum_stock"]').addClass("wcwl_disabled"))}),m(".options").on("click","button",function(){y(this);var e,c,t,i,a,n=m(this).closest(".wcwl_tab_content"),w=C(this),l=n.find('input[name="enable_stock_trigger"]').is(":checked"),s={enable_waitlist:n.find('input[name="enable_waitlist"]').is(":checked"),enable_stock_trigger:l},o=n.find('input[name="minimum_stock"]');s.minimum_stock=l?o.val():o.data("default-stock"),o.val(s.minimum_stock),c=w,t=s,i=(e=n).find("button"),a={action:"wcwl_update_waitlist_options",product_id:c,options:t,wcwl_update_nonce:i.data("nonce")},m.post(ajaxurl,a,function(t){m(".wcwl_notice").remove();var i=m.parseJSON(t);x(i.type,i.message,c,"options"),A(e,"update_options",wcwl_tab.update_button_text)})}),m("#wcwl_waitlist_data").on("keyup keypress",'input.wcwl_email, input[name="minimum_stock"]',function(t){13===(t.keyCode||t.which)&&(t.preventDefault(),"minimum_stock"==m(this).attr("name")?m(this).closest(".options").find("button").trigger("click"):m(this).next("button").trigger("click"))});var r=null,u=null;function p(){m(".waitlist .wcwl_user_checkbox").click(function(t){i(m(".waitlist .wcwl_user_checkbox"),this,r,"waitlist",t)}),m(".archive .wcwl_user_checkbox").click(function(t){i(m(".archive .wcwl_user_checkbox"),this,u,"archive",t)})}function i(t,i,e,c,a){if(e){if(a.shiftKey){var n=t.index(i),w=t.index(e);t.slice(Math.min(n,w),Math.max(n,w)+1).prop("checked",e.checked)}"waitlist"==c?r=i:u=i}else"waitlist"==c?r=i:u=i}});